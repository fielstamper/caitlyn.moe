<div id="lastfm-grid"><slot /></div>

<script>
	document.addEventListener("astro:page-load", () => {
		const LASTFM_KEY = "e2567caa43c5b556780a6470968e8bb1";

		fetch(
			"https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=lightafterruin&api_key=e2567caa43c5b556780a6470968e8bb1&extended=1&format=json&limit=5",
		)
			.then((response) => response.json())
			.then((jsonData) => {
				const lastfmGrid = document.getElementById("lastfm-grid")!;
				const tracks = jsonData.recenttracks.track;

				for (const track of tracks) {
					const trackURL = document.createElement("p");
					trackURL.textContent = track.url;

					const trackAnchor = document.createElement("a");
					trackAnchor.className = "track";
					trackAnchor.setAttribute("href", track.url);

					const artistName = document.createElement("p");
					artistName.textContent = track.artist.name;
					artistName.classList.add("artistName");

					const trackNameP = document.createElement("p");
					trackNameP.textContent = track.name;
					trackNameP.classList.add("redColor");

					const trackImg = document.createElement("img");
					trackImg.src = track.image[2]["#text"];
					trackImg.classList.add("trackImg");

					const fmText = document.createElement("p");
					fmText.append(trackNameP, artistName);
					fmText.classList.add("fmText");

					trackAnchor.append(trackImg, fmText);
					lastfmGrid.append(trackAnchor);
				}
			});
	});
</script>

<style is:global>
	#lastfm-grid {
		display: flex;
		width: 50em;
		overflow: hidden;
		text-align: center;
		height: 13em;
		gap: 43px;
	}

	.fmText {
		transition: all 0.25s cubic-bezier(0.17, 0.85, 0.29, 0.95);
		border-radius: 8px;
		opacity: 100%;
	}

	.fmText:hover {
		cursor: pointer;
		opacity: 50%;
		opacity: 40%;
	}

	@media (max-width: 768px) {
		#lastfm-grid {
			width: 100%;
			padding-left: 10px;
			overflow-x: scroll;
			height: 13em;
			font-size: 14px;
			gap: 20px;
		}
	}

	.track {
		text-decoration: none;
		height: 300px;
		width: 125px;
	}

	.track:hover {
		cursor: default;
	}

	@media (max-wdith: 768px) {
		.track {
			max-width: 100px !important;
		}
	}

	.trackImg {
		height: 125px;
		width: 125px;
		transition: all 0.25s cubic-bezier(0.17, 0.85, 0.29, 0.95);
		border-radius: 8px;
		opacity: 100%;
	}

	@media (max-width: 768px) {
		.trackImg {
			height: 100px;
			width: 100px;
		}
	}

	.trackImg:hover {
		background-color: rgba(12, 12, 12, 0.336);
		opacity: 40%;
		cursor: pointer;
	}

	.redColor {
		color: var(--track-name);
		display: -webkit-box;
		font-size: 16px;
		text-overflow: ellipsis;
		max-width: 7.3rem;
		overflow: hidden;
		-webkit-box-orient: vertical;
		-webkit-line-clamp: 2;
	}

	.artistName {
		font-weight: 200px;
		color: var(--artist-name);
		font-size: 14px;
		display: block;
		text-overflow: ellipsis;
	}

	@media (max-width: 768px) {
		.artistName {
			font-size: 12px;
		}
	}
</style>
